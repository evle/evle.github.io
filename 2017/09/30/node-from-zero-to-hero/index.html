<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>
    Evle&#39;s Blog
  </title>
  <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/css/bootstrap.min.css" integrity="sha384-PsH8R72JQ3SOdhVi3uxftmaW6Vc51MKb0q5P2rRUpPvrszuE4W1povHYgTpBfshb"
      crossorigin="anonymous">
    
      <link rel="icon" href="/images/favicon.ico">
      
      <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">

<link rel="stylesheet" href="/css/prism.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head>

  <body>
  <a href="https://github.com/evle" class="github-corner" aria-label="View source on Github"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#70B7FD; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
    <header class="d-flex justify-content-between align-items-center">
<div class="logo">
 <a href="/">Evle&#39;s Blog</a>
</div>

<nav class="d-inline-flex">
  <ul class="nav">
    
    <li class="nav-item">
      <a class="nav-link" href="/"> Home</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-link" href="/archives"> Archives</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-link" href="/category/"> Category</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-link" href="/search"> Search</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-link" href="/about/"> About</a>
    </li>
    
  </ul>
</nav>
</header>


   <div id="main-content"> 
      
         <article class="post">
  <div class="post-title">
    <h2 class="title">
      Node.js Foundation
    </h2>
  </div>

  <div class="post-meta">
    <span class="post-date">
      Publish on 2017-12-15
    </span>
  </div>

  <div class="post-content">
    <h2 id="Prepare-for-happy-hacking"><a href="#Prepare-for-happy-hacking" class="headerlink" title="Prepare for happy hacking"></a>Prepare for happy hacking</h2><ul>
<li>Node.js Installation: <code>brew install node</code></li>
<li>REPL mode: <code>node</code>  </li>
<li>Execution: <code>node app.js</code></li>
</ul>
<p><a href="https://nodejs.org/api/" target="_blank" rel="noopener">查看Node.js API</a></p>
<h3 id="NPM-Usage"><a href="#NPM-Usage" class="headerlink" title="NPM Usage:"></a>NPM Usage:</h3><p><em>NPM</em> 是node.js的第三方包管理工具，在开始node.js项目之前，通常在该目录下创建<code>package.json</code>文件来管理第三包以及项目信息.</p>
<ol>
<li>初始化<code>package.json</code>文件<pre><code>$ npm init
</code></pre></li>
<li>搜索 nodejs 第三方包<pre><code>$ npm search express
</code></pre></li>
<li>安装第三方包<pre><code>$ npm install -g express  // 全局安装
$ npm install --save express // 本目录下安装
</code></pre></li>
<li>更新<pre><code>$ npm update express
</code></pre></li>
<li>卸载<pre><code>$ npm uninstall express
</code></pre></li>
</ol>
<h2 id="Module"><a href="#Module" class="headerlink" title="Module"></a>Module</h2><p>导出：<code>exports</code>或者<code>module.exports</code><br>导入：<code>require</code><br><strong>index.js</strong>:</p>
<pre><code>const hello = require(&#39;./hello&#39;);
const Cat = require(&#39;./cat&#39;);

hello.hello();

let cat = new Cat();
cat.eat();
cat.sleep();
</code></pre><p><strong>hello.js</strong>:</p>
<pre><code>function hello{
  console.log(&#39;hello from hello.js&#39;);
}
exports.hello = hello;
</code></pre><p><strong>cat.js</strong>:</p>
<pre><code>function cat(){
  this.eat = function eat(){
    console.log(&#39;eat&#39;);
  }
  this.sleep = function sleep(){
    console.log(&#39;sleep&#39;);
  }
}

module.exports = cat;
</code></pre><h2 id="Events"><a href="#Events" class="headerlink" title="Events"></a>Events</h2><p>node.js的特性之一就是 <strong>event-driven</strong>，比如<code>fs.readStream</code>在读取文件时会产生一个事件. 所有像这样可以产生事件的对象都是<code>events.EventEmitter</code>的 <em>instance</em>. EventEmitter的 <em>instance</em> 通常会出发<code>error</code>事件,例如</p>
<pre><code>fs.mkdir(&#39;./newdir&#39;, (err) =&gt; {}))
</code></pre><h3 id="监听事件"><a href="#监听事件" class="headerlink" title="监听事件"></a>监听事件</h3><p><code>emitter.on(event, listener)</code> or <code>emitter.addListener(event, listener)</code><br>只生效一次:<code>emitter.once(event, listener)</code></p>
<h3 id="移除监听"><a href="#移除监听" class="headerlink" title="移除监听"></a>移除监听</h3><p><code>removeListern(event, listener)</code><br>全部移除: <code>removeAllListeners()</code></p>
<h3 id="设置-查询-监听器个数"><a href="#设置-查询-监听器个数" class="headerlink" title="设置/查询 监听器个数"></a>设置/查询 监听器个数</h3><p>设置：<code>events.EventEmitter.defaultMaxListeners = 20;</code><br>查询：<code>const cnt = events.EventEmitter.listenerCount(server, &#39;myevent&#39;);</code></p>
<h3 id="自定义事件"><a href="#自定义事件" class="headerlink" title="自定义事件"></a>自定义事件</h3><pre><code>server.on(&#39;myevent&#39;, (arg) =&gt; {
    console.log(&#39;receive event: &#39; + arg);
});

server.emit(&#39;myevent&#39;, &#39;it\&#39;me&#39;);
</code></pre><h2 id="fs-module"><a href="#fs-module" class="headerlink" title="fs module"></a>fs module</h2><p><code>require(&#39;fs&#39;)</code> for file operation</p>
<h3 id="删除文件"><a href="#删除文件" class="headerlink" title="删除文件"></a>删除文件</h3><p><code>fs.unlink(&#39;filename&#39;, (err) =&gt; {})</code></p>
<h3 id="创建目录"><a href="#创建目录" class="headerlink" title="创建目录"></a>创建目录</h3><p><code>fs.mkdir(&#39;./newdir&#39;, (err) =&gt; {})</code></p>
<h3 id="读取目录"><a href="#读取目录" class="headerlink" title="读取目录"></a>读取目录</h3><p><code>fs.readdir(&#39;./&#39;, (err, files) =&gt; {})</code></p>
<h3 id="读-写文件"><a href="#读-写文件" class="headerlink" title="读/写文件"></a>读/写文件</h3><p><code>fs.readFile(&#39;filename&#39;, &#39;utf-8&#39;, (err, data) =&gt; {})</code><br><code>fs.writeFile(&#39;filename&#39;, &#39;something new&#39;, { &#39;flag&#39;:&#39;a+&#39;}, (err, data) =&gt; {})</code></p>
<table>
<thead>
<tr>
<th>flag</th>
<th>note</th>
</tr>
</thead>
<tbody>
<tr>
<td>r</td>
<td>读取文件，文件不存在时报错</td>
</tr>
<tr>
<td>r+</td>
<td>读取并写入文件，文件不存在时报错</td>
</tr>
<tr>
<td>rs</td>
<td>以同步方式读取文件，文件不存在时报错</td>
</tr>
<tr>
<td>rs+</td>
<td>以同步方式读取并写入文件，文件不存在时报错</td>
</tr>
<tr>
<td>w</td>
<td>写入文件，文件不存在则创建，存在则清空</td>
</tr>
<tr>
<td>wx</td>
<td>和w一样，但是文件存在时会报错</td>
</tr>
<tr>
<td>w+</td>
<td>读取并写入文件，文件不存在则创建，存在则清空</td>
</tr>
<tr>
<td>wx+</td>
<td>和w+一样，但是文件存在时会报错</td>
</tr>
<tr>
<td>a</td>
<td>以追加方式写入文件，文件不存在则创建</td>
</tr>
<tr>
<td>ax</td>
<td>和a一样，但是文件存在时会报错</td>
</tr>
<tr>
<td>a+</td>
<td>读取并追加写入文件，文件不存在则创建</td>
</tr>
<tr>
<td>ax+</td>
<td>和a+一样，但是文件存在时会报错</td>
</tr>
</tbody>
</table>
<h3 id="读-写"><a href="#读-写" class="headerlink" title="读/写"></a>读/写</h3><pre><code>const fs = require(&#39;fs&#39;);

fs.open(&#39;filename&#39;, &#39;w+&#39;, (err, fd) =&gt; {
    if (err) {
        throw err;
    }

    // Write
    let bufWriter = new Buffer(&#39;node.js from zero to hero!&#39;);

    fs.write(fd, bufWriter, 0, bufWriter.length, 0, (err, bytes, buffer) =&gt; {
        if (err) {
            throw err;
        }

        console.log(&#39;W: &#39; + buffer.slice(0, bytes));
    });

    // Read
    let bufReader = new Buffer(255);
    fs.read(fd, bufReader, 0, 100, 0, (err, bytes, buffer) =&gt; {
        console.log(&#39;R: &#39; + buffer.slice(0, bytes));
    });

    fs.close(fd);
});
</code></pre><h2 id="process"><a href="#process" class="headerlink" title="process"></a>process</h2><p>process 也是 EventEmiter的一个 <em>instance</em></p>
<h3 id="信号事件"><a href="#信号事件" class="headerlink" title="信号事件"></a>信号事件</h3><p>Node.js支持标准的 <a href="http://man7.org/linux/man-pages/man7/signal.7.html" target="_blank" rel="noopener"><em>POSIX signal</em></a></p>
<pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">// Example: Interrupt from keyboard(control-c)</span>

process<span class="token punctuation">.</span>stdin<span class="token punctuation">.</span><span class="token function">resume</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// begin reading from stdin</span>

process<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'SIGINT'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Received SIGINT.  Press Control-D to exit.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="获取输入流"><a href="#获取输入流" class="headerlink" title="获取输入流"></a>获取输入流</h3><pre class="line-numbers language-javascript"><code class="language-javascript">process<span class="token punctuation">.</span>stdin<span class="token punctuation">.</span><span class="token function">setEncoding</span><span class="token punctuation">(</span><span class="token string">'utf8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

process<span class="token punctuation">.</span>stdin<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'readable'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> chunk <span class="token operator">=</span> process<span class="token punctuation">.</span>stdin<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>chunk<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        process<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`data: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>chunk<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

process<span class="token punctuation">.</span>stdin<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'end'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    process<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">'end'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="net-amp-dgram-module"><a href="#net-amp-dgram-module" class="headerlink" title="net &amp; dgram module"></a>net &amp; dgram module</h2><p><code>require(&#39;net&#39;)</code> for building TCP server<br><code>require(&#39;dgram&#39;)</code> for building UDP server</p>
<h3 id="TCP-Server"><a href="#TCP-Server" class="headerlink" title="TCP Server"></a>TCP Server</h3><h4 id="创建TCP-Server"><a href="#创建TCP-Server" class="headerlink" title="创建TCP Server"></a>创建TCP Server</h4><p><code>const server = net.createServer((socket) =&gt; {})</code></p>
<h4 id="接收来自客户端的消息"><a href="#接收来自客户端的消息" class="headerlink" title="接收来自客户端的消息"></a>接收来自客户端的消息</h4><p><code>socket.on(&#39;data&#39;, (data) =&gt; {})</code></p>
<h4 id="发送数据给客户端："><a href="#发送数据给客户端：" class="headerlink" title="发送数据给客户端："></a>发送数据给客户端：</h4><p><code>socket.write(&#39;message&#39;)</code>  </p>
<h4 id="监听"><a href="#监听" class="headerlink" title="监听"></a>监听</h4><p><code>server.listen(port, () =&gt; { &#39;server is running&#39;})</code></p>
<h3 id="TCP-Client"><a href="#TCP-Client" class="headerlink" title="TCP Client"></a>TCP Client</h3><h4 id="连接TCP-Server"><a href="#连接TCP-Server" class="headerlink" title="连接TCP Server"></a>连接TCP Server</h4><p><code>const client = net.connect({port: 8080}, function() {});</code></p>
<h4 id="发送数据给服务器端"><a href="#发送数据给服务器端" class="headerlink" title="发送数据给服务器端:"></a>发送数据给服务器端:</h4><p><code>client.write(&#39;message&#39;)</code></p>
<h4 id="接收来自服务器的消息"><a href="#接收来自服务器的消息" class="headerlink" title="接收来自服务器的消息"></a>接收来自服务器的消息</h4><p><code>client.on(&#39;data&#39;, (data) =&gt; {})</code></p>
<h4 id="断开连接"><a href="#断开连接" class="headerlink" title="断开连接"></a>断开连接</h4><p><code>client.end()</code></p>
<h3 id="UDP-Server"><a href="#UDP-Server" class="headerlink" title="UDP Server"></a>UDP Server</h3><h4 id="创建UDP-Server"><a href="#创建UDP-Server" class="headerlink" title="创建UDP Server"></a>创建UDP Server</h4><p><code>const server = dgram.createSocket(&#39;udp4&#39;)</code></p>
<h4 id="接收来自客户端消息"><a href="#接收来自客户端消息" class="headerlink" title="接收来自客户端消息"></a>接收来自客户端消息</h4><p><code>server.on(&#39;message&#39;, (msg, client) =&gt; { client.port/address})</code></p>
<h4 id="监听-1"><a href="#监听-1" class="headerlink" title="监听"></a>监听</h4><p><code>server.on(&#39;listening&#39;,() =&gt; { server listening on server.address()})</code></p>
<h4 id="绑定"><a href="#绑定" class="headerlink" title="绑定"></a>绑定</h4><p><code>server.bind(port)</code></p>
<h3 id="UDP-Client"><a href="#UDP-Client" class="headerlink" title="UDP Client"></a>UDP Client</h3><h4 id="创建UDP-Client"><a href="#创建UDP-Client" class="headerlink" title="创建UDP Client"></a>创建UDP Client</h4><p><code>const client = dgram.createSocket(&#39;udp4&#39;)</code></p>
<h4 id="发送数据给服务器端-1"><a href="#发送数据给服务器端-1" class="headerlink" title="发送数据给服务器端"></a>发送数据给服务器端</h4><p><code>client.send(msg, msg.length, port, address, callback())</code></p>
<h3 id="Example-Chat"><a href="#Example-Chat" class="headerlink" title="Example: Chat"></a>Example: Chat</h3><p><strong>Server.js</strong></p>
<pre><code>const net = require(&#39;net&#39;);

const sockets = [];
const server = net.createServer();

server.on(&#39;connection&#39;, (socket) =&gt; {
    console.log(&#39;A client connected&#39;);
    sockets.push(socket);

    socket.on(&#39;data&#39;, (data) =&gt; {
        sockets.forEach((sock) =&gt; {
            if (sock != socket) {
                sock.write(data);
            }
        });
    });

    socket.on(&#39;close&#39;, (data) =&gt; {
        console.log(&#39;A client connection closed&#39;);
        let index = sockets.indexOf(socket);
        socket.splice(index, 1);
    });
});

server.listen(3333);
</code></pre><p><strong>Client.js</strong></p>
<pre><code>const net = require(&#39;net&#39;);

process.stdin.resume();

const client = net.connect(3333, () =&gt; {
    console.log(&#39;Connected to server&#39;);
});

process.stdin.on(&#39;data&#39;, (data) =&gt; {
    client.write(data);
});

client.on(&#39;data&#39;, (data) =&gt; {
    console.log(data.toString());
});
</code></pre><h3 id="http-module"><a href="#http-module" class="headerlink" title="http module"></a>http module</h3><p>Using <code>http</code> module to build a <strong>Web Server</strong>.</p>
<pre><code>app
├── app.js
├── requestHandlers.js
├── router.js
├── server.js
└── views
    ├── 404.html
    └── home.html
</code></pre><h4 id="app-js"><a href="#app-js" class="headerlink" title="app.js"></a>app.js</h4><p><strong>app.js</strong> 是程序的入口，设置路由并且启动服务器.</p>
<pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token keyword">const</span> server <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./server'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./router'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> requestHandlers <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./requestHandlers'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> handle <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
handle<span class="token punctuation">[</span><span class="token string">'/'</span><span class="token punctuation">]</span> <span class="token operator">=</span> requestHandlers<span class="token punctuation">.</span>home<span class="token punctuation">;</span>

server<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span>route<span class="token punctuation">,</span> handle<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="server-js"><a href="#server-js" class="headerlink" title="server.js"></a>server.js</h4><p>创建服务器, 将服务器接收到的客户端请求传递给路由处理</p>
<pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token keyword">const</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'url'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> host <span class="token operator">=</span> <span class="token string">'127.0.0.1'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> port <span class="token operator">=</span> <span class="token number">8080</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">start</span><span class="token punctuation">(</span>route<span class="token punctuation">,</span> handle<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">function</span> <span class="token function">onRequest</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> pathname <span class="token operator">=</span> url<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">.</span>pathname<span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Request for '</span> <span class="token operator">+</span> pathname <span class="token operator">+</span> <span class="token string">' received.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">route</span><span class="token punctuation">(</span>handle<span class="token punctuation">,</span> pathname<span class="token punctuation">,</span> res<span class="token punctuation">,</span> req<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span>onRequest<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>port<span class="token punctuation">,</span> host<span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Sever has started and listenning on'</span> <span class="token operator">+</span> host <span class="token operator">+</span> <span class="token string">':'</span> <span class="token operator">+</span> port<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

exports<span class="token punctuation">.</span>start <span class="token operator">=</span> start<span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="router-js"><a href="#router-js" class="headerlink" title="router.js"></a>router.js</h4><p>判断路由是否合法</p>
<pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token keyword">var</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">route</span><span class="token punctuation">(</span>handle<span class="token punctuation">,</span> pathname<span class="token punctuation">,</span> res<span class="token punctuation">,</span> req<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> handle<span class="token punctuation">[</span>pathname<span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        handle<span class="token punctuation">[</span>pathname<span class="token punctuation">]</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> req<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> content <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span><span class="token string">'./views/404.html'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        res<span class="token punctuation">.</span><span class="token function">writeHead</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string">'Content-Type'</span><span class="token punctuation">:</span> <span class="token string">'text/html'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        res<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>
        res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

exports<span class="token punctuation">.</span>route <span class="token operator">=</span> route<span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="requestHandlers-js"><a href="#requestHandlers-js" class="headerlink" title="requestHandlers.js"></a>requestHandlers.js</h4><p>处理每个请求</p>
<pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">home</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> content <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span><span class="token string">'./views/home.html'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    res<span class="token punctuation">.</span><span class="token function">writeHead</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">'Content-Type'</span><span class="token punctuation">:</span> <span class="token string">'text/html'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    res<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>
    res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

exports<span class="token punctuation">.</span>home <span class="token operator">=</span> home<span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="Express"><a href="#Express" class="headerlink" title="Express"></a>Express</h2><h3 id="构建项目"><a href="#构建项目" class="headerlink" title="构建项目"></a>构建项目</h3><pre><code>$ mkdir node-express &amp;&amp; cd node-express
$ npm init
$ npm i --save express
</code></pre><h3 id="Code-Base"><a href="#Code-Base" class="headerlink" title="Code Base"></a>Code Base</h3><pre><code>const express = require(&#39;express&#39;);

const app = express();
const port = 3000;

app.get(&#39;/&#39;, (req, res) =&gt; {
    res.send(&#39;Hello Express&#39;);
});

app.listen(port, () =&gt; {
    console.log(`Server is running at port ${port}`);
});
</code></pre><h3 id="获取Query"><a href="#获取Query" class="headerlink" title="获取Query"></a>获取Query</h3><pre><code>// http://localhost:3000/?q=something
let q = req.query.q;
let md5Value = utility.md5(q);
res.send(md5Value);
</code></pre><h3 id="Web-Scraping"><a href="#Web-Scraping" class="headerlink" title="Web Scraping"></a>Web Scraping</h3><p>Web scraping is a technique in data extraction where you pull information from websites.<br>依赖模块: <code>superagent</code>, <code>cheerio</code></p>
<h4 id="superagent"><a href="#superagent" class="headerlink" title="superagent"></a>superagent</h4><h5 id="获取指定网页内容"><a href="#获取指定网页内容" class="headerlink" title="获取指定网页内容"></a>获取指定网页内容</h5><pre><code>superagent.get(&#39;https://github.com/topics/nodejs&#39;)
        .end(function (err, content){
          console.log(content);
        }
</code></pre><h4 id="cheerio"><a href="#cheerio" class="headerlink" title="cheerio"></a>cheerio</h4><p><a href="https://github.com/cheeriojs/cheerio" target="_blank" rel="noopener">read more</a><br><a href="https://github.com/evle/top-rated-movies-scraping" target="_blank" rel="noopener">实例: 获取评分最高的电影从http://www.imdb.com</a></p>
<h5 id="Loading"><a href="#Loading" class="headerlink" title="Loading"></a>Loading</h5><pre><code>const $ = cheerio.load(content.text);
const $ = cheerio.load(&#39;&lt;ul id=&quot;fruits&quot;&gt;...&lt;/ul&gt;&#39;);
</code></pre><h5 id="Selectors"><a href="#Selectors" class="headerlink" title="Selectors"></a>Selectors</h5><pre><code>$(&#39;.apple&#39;, &#39;#fruits&#39;).text()
$(&#39;ul .pear&#39;).attr(&#39;class&#39;)
$(&#39;li[class=orange]&#39;).html()
</code></pre><h5 id="Attributes"><a href="#Attributes" class="headerlink" title="Attributes"></a>Attributes</h5><pre><code>$(&#39;ul&#39;).attr(&#39;id&#39;)
$(&#39;.apple&#39;).attr(&#39;id&#39;, &#39;favorite&#39;).html()
</code></pre><h4 id="eventproxy"><a href="#eventproxy" class="headerlink" title="eventproxy"></a>eventproxy</h4><h4 id="Travis-CI-Test-and-Deploy-with-Confidence"><a href="#Travis-CI-Test-and-Deploy-with-Confidence" class="headerlink" title="Travis CI - Test and Deploy with Confidence"></a>Travis CI - Test and Deploy with Confidence</h4>
  </div>

</article>


 
        

          
     </main>

            <footer class="d-flex justify-content-around align-items-center text-white">
 
<div></div>

     
      <div>
      &copy;
      2017
        Max Lee
      </div>


<div class="">
  <div class="">
      Powered by
      <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>

 
 <div class="">
    Theme -
    <a href="git@github.com:evle/min.git" target="_blank">Min</a>
 </div>
 
 </div>

</footer>
       
             
  </body>



</html>